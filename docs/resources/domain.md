---
page_title: "qrator_domain Resource - terraform-provider-qrator"
subcategory: ""
description: |-
  Manages a domain in Qrator, including its name and service list.
---

# qrator_domain (Resource)

Manages a domain in Qrator, including its name and the full list of services (HTTP, NAT, NAT-all, TCP proxy, WebSocket).

The API works on a bulk/replace basis: `services_set` accepts the entire list at once. There are no individual add/remove operations — the provider reads the current list, applies changes, and writes the full list back.

~> **Note:** Deleting this resource does not remove the domain itself — it only clears the service list.

## Example Usage

### Basic HTTP service

```terraform
resource "qrator_domain" "web" {
  id   = 12345
  name = "example.com"

  services {
    http = [
      {
        port              = 80
        upstream_balancer = "roundrobin"
        upstream_weights  = false
        upstream_backups  = false
        upstream_ssl      = false
        upstreams = [
          { ip = "10.0.0.1", port = 8080, weight = 100, type = "primary" }
        ]
      }
    ]
  }
}
```

### HTTPS with HTTP/2

```terraform
resource "qrator_domain" "https" {
  id   = 12345
  name = "example.com"

  services {
    http = [
      {
        port              = 443
        ssl               = true
        http2             = true
        upstream_balancer = "roundrobin"
        upstream_weights  = true
        upstream_backups  = false
        upstream_ssl      = true
        upstreams = [
          { ip = "10.0.0.1", port = 8443, weight = 100, type = "primary" },
          { ip = "10.0.0.2", port = 8443, weight = 50,  type = "backup" }
        ]
      }
    ]
  }
}
```

~> **Validation:** `http2 = true` requires `ssl = true`. Setting `http2 = true` with `ssl = false` will produce a validation error.

### HTTPS with SNI

```terraform
resource "qrator_domain" "with_sni" {
  id   = 12345
  name = "example.com"

  services {
    http = [
      {
        port              = 443
        ssl               = true
        http2             = true
        upstream_balancer = "roundrobin"
        upstream_weights  = false
        upstream_backups  = false
        upstream_ssl      = true
        upstreams = [
          { ip = "10.0.0.1", port = 8443, weight = 100, type = "primary" }
        ]
      }
    ]
  }

  sni = [
    {
      # Default certificate (host = null) — required when SNI is non-empty
      certificate = qrator_client_certificate.default.id
    },
    {
      host        = "example.com"
      certificate = qrator_client_certificate.cert.id
    },
    {
      host        = "www.example.com"
      certificate = qrator_client_certificate.cert.id
    }
  ]
}
```

### Multiple service types

```terraform
resource "qrator_domain" "full" {
  id   = 12345
  name = "example.com"

  services {
    http = [
      {
        port              = 80
        upstream_balancer = "roundrobin"
        upstream_weights  = false
        upstream_backups  = false
        upstream_ssl      = false
        upstreams = [
          { ip = "10.0.0.1", port = 8080, weight = 100, type = "primary" }
        ]
      },
      {
        port              = 443
        ssl               = true
        http2             = true
        upstream_balancer = "roundrobin"
        upstream_weights  = true
        upstream_backups  = false
        upstream_ssl      = true
        upstreams = [
          { ip = "10.0.0.1", port = 8443, weight = 100, type = "primary" }
        ]
      }
    ]

    nat = [
      {
        port          = 53
        proto         = "udp"
        drop_amp      = true
        upstream_ip   = "10.0.0.2"
        upstream_port = 53
      }
    ]

    nat_all = [
      {
        proto       = "tcp"
        upstream_ip = "10.0.0.3"
      }
    ]

    tcpproxy = [
      {
        port = 3306
        upstreams = [
          { ip = "10.0.0.4", port = 3306, weight = 100, type = "primary" }
        ]
      }
    ]

    websocket = [
      {
        port         = 443
        ssl          = true
        upstream_ssl = true
        upstreams = [
          { ip = "10.0.0.5", port = 8443, weight = 100, type = "primary" }
        ]
      }
    ]
  }
}
```

## Import

Existing domains can be imported using the domain ID:

```shell
terraform import qrator_domain.example 12345
```

After import, run `terraform plan` to see the current state read from the API.

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `id` (Number) The domain ID. Changing this forces resource replacement.

### Optional

- `name` (String) The domain name.
- `services` (Attribute) Service list for the domain.
- `sni` (List of Object) SNI configuration. List of hostname-to-certificate mappings.

### Nested Schema for `services`

All lists are optional:

- `http` (List of Object) HTTP service entries.
- `nat` (List of Object) NAT (TCP/UDP) service entries.
- `nat_all` (List of Object) NAT-all (all ports) service entries.
- `tcpproxy` (List of Object) TCP proxy service entries.
- `websocket` (List of Object) WebSocket service entries.

### Nested Schema for `services.http`

Required:

- `port` (Number) Listening port (1–65535).
- `upstream_balancer` (String) Load balancing algorithm: `roundrobin` or `iphash`.
- `upstream_weights` (Boolean) Enable weight-based load balancing.
- `upstream_backups` (Boolean) Enable backup server support.
- `upstream_ssl` (Boolean) Enable SSL/TLS for upstream connections.
- `upstreams` (List of Object) Upstream servers (see below).

Optional:

- `ssl` (Boolean) Enable SSL/TLS on the frontend.
- `http2` (Boolean) Enable HTTP/2. Requires `ssl = true`.
- `default_drop` (Boolean) If true, only whitelisted IPs can access the service.
- `upstream_sni_name` (String) SNI hostname for upstream TLS connections.
- `upstream_sni_override` (Boolean) Force use of `sni_name` as HOST header in upstream requests.

Read-Only:

- `id` (Number) Service entry ID assigned by the API.

### Nested Schema for `services.nat`

Required:

- `port` (Number) Listening port (1–65535).
- `proto` (String) Protocol: `tcp` or `udp`.
- `upstream_ip` (String) Upstream server IPv4 address.
- `upstream_port` (Number) Upstream server port (1–65535).

Optional:

- `default_drop` (Boolean) If true, only whitelisted IPs can access the service.
- `drop_amp` (Boolean) Drop amplified packets. Only for UDP.
- `rate_limit` (Number) Maximum packet rate (bps), 8000–1000000000000, multiple of 8000. Only for UDP.

Read-Only:

- `id` (Number) Service entry ID assigned by the API.

### Nested Schema for `services.nat_all`

Required:

- `proto` (String) Protocol: `tcp` or `udp`.
- `upstream_ip` (String) Upstream server IPv4 address.

Optional:

- `default_drop` (Boolean) If true, only whitelisted IPs can access the service.
- `drop_amp` (Boolean) Drop amplified packets. Only for UDP.
- `rate_limit` (Number) Maximum packet rate (bps), 8000–1000000000000, multiple of 8000. Only for UDP.

Read-Only:

- `id` (Number) Service entry ID assigned by the API.

### Nested Schema for `services.tcpproxy`

Required:

- `port` (Number) Listening port (1–65535).
- `upstreams` (List of Object) Upstream servers (see below).

Optional:

- `default_drop` (Boolean) If true, only whitelisted IPs can access the service.
- `proxy_protocol` (Number) Proxy protocol version: `0`, `1`, or `2`.

Read-Only:

- `id` (Number) Service entry ID assigned by the API.

### Nested Schema for `services.websocket`

Required:

- `port` (Number) Listening port (1–65535).
- `upstreams` (List of Object) Upstream servers (see below).

Optional:

- `ssl` (Boolean) Enable SSL/TLS on the frontend.
- `default_drop` (Boolean) If true, only whitelisted IPs can access the service.
- `upstream_ssl` (Boolean) Enable SSL/TLS for upstream connections.

Read-Only:

- `id` (Number) Service entry ID assigned by the API.

### Nested Schema for upstream servers

Used by `http`, `tcpproxy`, and `websocket` service types.

Required:

- `ip` (String) Server IPv4 address. Either `ip` or `dns_record` must be set.
- `port` (Number) Server port.
- `weight` (Number) Weight for load balancing.
- `type` (String) Server role: `primary` or `backup`.

Optional:

- `dns_record` (String) DNS record instead of IP (HTTP and WebSocket only).
- `name` (String) Human-readable server name.

### Nested Schema for `sni`

- `host` (String, Optional) The hostname. Omit (null) for the default domain certificate.
- `certificate` (Number, Required) The certificate ID from storage.

## Validation Rules

**Services:**
- No duplicate services with the same composite key (type + port/proto).
- `nat_all`: at most 1 TCP and 1 UDP entry.
- `drop_amp` and `rate_limit` are only valid for UDP services (nat, nat_all).
- `http2 = true` requires `ssl = true`.

**SNI:**
- Non-empty SNI list must include a default entry (with `host` omitted/null).
- No duplicate hostnames.
- Maximum 1000 entries.
- Only port 443 is supported (hardcoded, not exposed in schema).
